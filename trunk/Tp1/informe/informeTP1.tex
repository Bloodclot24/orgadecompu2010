\documentclass[a4paper,10pt]{article}

\usepackage[ansinew]{inputenc}
\usepackage[spanish]{babel}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{appendix}
\usepackage{pdfpages}
\usepackage{fancyhdr}
\usepackage{paralist}
\pagestyle{fancy}

\begin{document}

\lhead{\fancyplain{}{Organizaci\'on de computadoras 66.20 - Turno Martes}}
\rhead{\fancyplain{}{Trabajo Pr\'actico 1A}}

\setcounter{page}{2}

\newpage
\thispagestyle{empty}
\tableofcontents

\newpage
\section{Introducci\'on}
   En el presente trabajo pr\'actico se busc\'o  familiarizarse con el conjunto de instrucciones MIPS y el concepto de ABI. Para ello se implementaron dos programas completamente en assembly MIPS, que permiten convertir informaci\'on almacenada en streams de texto, para transformar archivos de texto de UNIX a DOS; y dos2unix para realizar la operacion inversa. Es decir, siguiendo la l\'inea de trabajo de los pr\'acticos anteriores, buscamos generar dos binarios diferentes en vez de un \'unico programa que resuelva ambos problemas.

\section{Resoluci\'on del problema}
  Lo primero que se realiz\'o para cada funci\'on del programa, fue realizar su Stack Frame correspondiente.
  Para ellos se tuvo en cuentas los siguientes puntos: 
  \begin{itemize}
    \item El Stack Frame se compone de areas de un tama\~no m\'ultiplo de 8 bytes, alineadas a 8 bytes.
    \item Los registros en un area se almacenan de abajo hacia arriba, en orden seg\'un el n\'umero de registro.
    \item Las areas son, en orden de aparici\'on (de arriba hacia abajo en memoria):
      \begin{enumerate}
	  \item General Register Save Area[SRA] (obligatoria 3). Registros salvados:
	    \begin{itemize}
	      \item Siempre: \$fp, gp;
	      \item Cuando la funci\'on es non-leaf: ra;
	      \item Si es necesario: el resto de los general purpose callee-saved regs.
	    \end{itemize}
	  \item Floating-Point Registers Save Area: f20 a f30 si es necesario.
	  \item Local and Temporary Variables Area[LTA].
	  \item Unspecified Area[UA]. (obligatoria, aparece siempre, no se almacena nada en ella y es de 8 bytes).
	  \item Argument Building Area[ABA].
	    \begin{itemize}
	      \item Se crea cuando la funci\'on es non-leaf;
	      \item Al menos es de 16 bytes, a\'un cuando los argumentos del callee requieren menos.
	      \item Cuando los cuatro primeros argumentos son enteros o punteros, se pasan en a0 a a3, y el resto se guarda en esta area a partir de los primeros 16 bytes.
	      \item Los argumentos pasados en a0 a a3 son almacenados en esta area por el callee siempre
	    \end{itemize}
      \end{enumerate}
  \end{itemize}
  
  A continuaci\'on se muestras los Stacks Frames.

  \subsection{Main}
    \subsubsection{Stack frame}
      \begin{center}
	\includegraphics[width=8cm, height=10cm]{DibujosStackFrame/stack-main.jpg}
      \end{center}

  \subsection{Funci\'on conversor}
    \subsubsection{Stack frame}
      \begin{center}
	\includegraphics[width=10cm, height=15cm]{DibujosStackFrame/stack-conversor.jpg}
      \end{center}

\section{Preparando el ambiente para NetBSD}
  Para probar el trabajo pr\'actico, lo primero que se debe realizar es enviar el c\'odigo assembly al entorno
  del NetBSD. Se considera que el NetBSD se encuentra corriendo y que se ha creado el loopback necesario. Para ello, se deben realizar los siguientes pasos:
  \begin{enumerate}
   \item Abrir una consola e ingresar en modo root.
   \item Copiar la carpeta ``Codigo`` del cd, a la carpeta del usuario gxemul:
    \newline 
      {\bf hostOS\# cp -r \textbackslash Unidad\_de\_CD\textbackslash Codigo \textbackslash home\textbackslash gxemul}
   \item Conectar con el NetBSD a trav\'es de un t\'unel, se debe ingresar el password correspondiente al 
	 usuario root del NetBSD:
    \newline
      {\bf hostOS\# ssh -p 2222 root@127.0.0.1}
   \item Crear una carpeta para el Tp1, opcional se utiliza para una mejor organizaci\'on:
    \newline 
    {\bf guestOS\# mkdir Tp1}
   \item Copiar la carpeta ''Codigo`` a la carpeta Tp1 del NetBSD, se debe ingresar el password correspondiente al
         usuario gxemul del sistema operativo host:
   \newline
    {\bf guestOS\# scp -r gxemul@172.20.0.1:\textbackslash home\textbackslash gxemul\textbackslash Codigo \newline Tp1\textbackslash }
  \end{enumerate} 

\section{Compilando en NetBSD}
  Para poder compilar desde NetBSD, primero abrir la ubicaci\'on Codigo/Assembly y luego ejecutar:
  \newline
  {\bf guestOS\# cc -o unix2dos unix2dos.S} \newline
  {\bf guestOS\# cc -o dos2unix dos2unix.S}
  \newline
  En ambos casos, se decidi\'o utilizar como nombre archivo de salida (opci\'on -o) el mismo del archivo 
  del c\'odigo assembly.

\section{Ejecutando los programas en NetBSD}
  Para ejecutar el programa, el comando a utilizar es:
  \newline
  {\bf./[nombre de ejecutable] -i [ruta de archivo origen] -o [ruta de archivo destino]}
  \newline
  En caso de que no se utilicen las opciones {\bf ``-i''} (archivo de entrada) y {\bf ``-o''} (archivo de salida) el 
  programa utiliza la entrada estandar (stdin) y salida estandar (stdout). Para ver ejemplos, observar 
  secci\'on de casos de prueba.

\section{Casos de prueba}
  TODO
\newpage
\section{Conclusiones}
  TODO

%APENDICES
\appendix
\newpage
\section{C\'odigo Fuente}
  \subsection{C\'odigo en C}
    \subsubsection{unix2dos.c}
      \lstset{numbers=left, frame=single, breaklines=true}
      \lstinputlisting{../src/CodigoC/unix2dos.c}
    \subsubsection{dos2unix.c}
      \lstset{numbers=left, frame=single, breaklines=true}
      \lstinputlisting{../src/CodigoC/dos2unix.c}
    \subsubsection{conversor.c}
      \lstset{numbers=left, frame=single, breaklines=true}
      \lstinputlisting{../src/CodigoC/conversor.c}
  \newpage
  \subsection{C\'odigo en Assembly}
    \subsubsection{unix2dos.S}
      \lstset{numbers=left, frame=single, breaklines=true}
      \lstinputlisting{../src/unix2dos.S}
    \subsubsection{dos2unix.S}
      \lstset{numbers=left, frame=single, breaklines=true}
      \lstinputlisting{../src/dos2unix.S}
    
\newpage
\section{Enunciado}
\includepdf[pages=1-3, scale=0.9, pagecommand={\thispagestyle{plain}}]{../tp1a-2010-2q.pdf}

\end{document}
